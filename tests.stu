@all.tests
:   tests/test.lambda1.0/output.actual
    tests/test0/output.actual
    tests/test0/gz/output.actual
    tests/test0/vcfGTz/output.actual
    tests/3.chromosomes/UKB.every100/output.actual
    tests/impute.range/chr1_1000000-chr1_2000000/output.actual
    tests/impute.range/chr2-3/output.actual
    tests/impute.range/chr2/output.actual
;

@test.data.to.be.made.by.stu :
    ref/compressed/small.vcf.sample.vcfGTz
    ref/compressed/TWINSUK.every100thRS.chrm123.100people.vcfGTz
    ref/tbi/small.vcf.sample.vcf.gz.tbi
    ref/tbi/TWINSUK.every100thRS.chrm123.100people.vcf.gz.tbi
;

    tests/${testname}/output.actual
:       bin/ssimp
    tests/${testname}/command
   @test.data.to.be.made.by.stu
{
    export SSIMP=bin/ssimp
    export   REF=ref
    export  GWAS=gwas
    export COMMANDDIR="tests/${testname}"
    export OUTPUT="tests/${testname}"/output.actual.tmp
    export OUT_IMPUTATIONS="tests/${testname}"/imputations.txt
    export FORCE_THOUSANDS_SEPARATOR="'"

    bash "tests/${testname}"/command

    mv "tests/${testname}"/output.actual.tmp "tests/${testname}"/output.actual
}


                    ref/compressed/${path}.vcfGTz
:   -p bin/vcfGTz
{
    export  target="ref/compressed/${path}".vcfGTz
    mkdir -p "$(dirname "$target")"
    export              input="ref/${path}".vcf.gz
    ls -l "$input"
    bin/vcfGTz "$input" "$target".tmp
    mv                  "$target".tmp "$target"
}
                    ref/${path}.vcf
{
    export  target="ref/${path}".vcf
    export              input="ref/${path}".vcf.gz
    ls -l "$input"
    gunzip -k "$input"
}

    ref/tbi/${path}.vcf.gz.tbi
:   ref/tbi/${path}.vcf.gz
{
    tabix ref/tbi/${path}.vcf.gz
}
                ref/tbi/${path}.vcf.gz
{
export  target="ref/tbi/${path}.vcf.gz"
    ls -l "ref/${path}".vcf.gz
    zcat "ref/${path}".vcf.gz | bgzip > "${target}".tmp
    mv "${target}"{.tmp,}
}
